{% extends 'signbase.html' %} {% block content %}
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e3f4fcd64134ce1b708dc9dae8e3bc0e"></script>
<header>
  <div class="topbar-sign">
    <span> 지역인증 </span>
    <div class="topbar-line"></div>
  </div>
</header>

<div id="main-title">
  <span id="title-1" style="color: black">어디에서 활동하시나요?</span><br />
  <span id="title-1" style="color: black">안전한 픽켓을 만들기 위해 지역을 인증해주세요!</span>
</div>
<div class="input-bar-wrapper">지도</div>
<form method="POST" action="{% url 'join3'%}">
  {% csrf_token %}
  <br /><br />

  <div class="input-positioner">

    <br />
    <input type="hidden" id="longitude" name="longitude" />
    <input type="hidden" id="latitude" name="latitude" />
    <div id="map" class="input-box-wrapper">
      <div style="width: 375px; height: 279px;">
      </div>
      <br />

      <div class="input-bar-wrapper">
        <input name="nickname" id="input-bar-join3" type="text" placeholder="" disabled />
      </div>

      <div class="">
        <button id="btn-signin" type="submit" onclick="location.href='join4'">
          완료하기
        </button>
      </div>
    </div>
</form>
<script>
  var map = null;
  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        x = position.coords.longitude
        y = position.coords.latitude
        map.setCenter(new kakao.maps.LatLng(y, x))
        document.getElementById('longitude').value = x;
        document.getElementById('latitude').value = y;
        getRegionFromLocation(x, y)
      }, function (error) {
        alert(`위치 정보를 받아올 수 없습니다.\n${error}`)
      }, {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: Infinity
      });
    } else {
      alert('GPS를 지원하지 않습니다.');
    }
  }
  function drawMap() {
    var container = document.getElementById('map'),
      options = {
        center: new kakao.maps.LatLng(33.450701, 126.570667),
        level: 3
      };

    map = new kakao.maps.Map(container, options);
  }
  function getRegionFromLocation(x, y) {
    url = `https://pickcat-kapi-proxy.jaewon.dev/v2/local/geo/coord2regioncode.json?x=${x}&y=${y}`
    Http = new XMLHttpRequest();
    Http.open("GET", url, true);
    Http.responseType = 'json';
    Http.send();
    Http.onreadystatechange = (e) => {
      if (Http.readyState == 4 && Http.status == 200) {
        data = Http.response;
        console.log(data.documents[0].region_3depth_name)
      }
    }
  }
  drawMap()
  getLocation()
</script>


{% endblock %}